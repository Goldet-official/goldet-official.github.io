<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Goldet — Leaderboard</title>
<link href="https://fonts.googleapis.com/css2?family=Titan+One&display=swap" rel="stylesheet" />

<style>
  *{box-sizing:border-box}
  html,body{margin:0;padding:0;height:100%;background:#080808;color:#fff;font-family:Arial,system-ui}

  /* Sidebar */
  .sidebar{position:fixed;left:0;top:0;bottom:0;width:240px;
    background:linear-gradient(180deg,#1a1200,#2e1a03);
    border-right:2px solid rgba(212,175,55,0.06);
    padding:22px;display:flex;flex-direction:column;gap:10px;}
  .sidebar a{color:#ffd;text-decoration:none;padding:10px;border-radius:8px}
  .sidebar a:hover{background:rgba(212,175,55,0.08)}
  .logo{font-family:'Titan One';font-size:34px;color:#ffd700}

  /* Main */
  .main{margin-left:260px;padding:24px}
  h1{font-family:'Titan One';color:#ffd700;margin-bottom:16px}

  .tabs{display:flex;gap:14px;margin-bottom:18px}
  .tab{
    padding:10px 16px;border-radius:10px;cursor:pointer;
    border:2px solid rgba(212,175,55,0.12);color:#ffd;
  }
  .tab.active{
    background:linear-gradient(90deg,#ffd700,#b8860b);
    color:#000;font-weight:900;
  }

  .board{margin-top:10px}
  .row{
    display:flex;justify-content:space-between;
    padding:12px 16px;border-bottom:1px solid rgba(255,255,255,0.06)
  }
  .rank{font-weight:900;color:#ffd700;width:40px}
  .username{font-weight:700}
  .score{font-weight:900;color:#ffd700}
</style>
</head>
<body>

<div class="sidebar">
  <div class="logo">Goldet</div>
  <a href="stats.html">Stats</a>
  <a href="leaderboard.html">Leaderboard</a>
  <a href="chat.html">Chat</a>
  <a href="market.html">Market</a>
  <a href="golds.html">Golds</a>
  <a href="admin.html">Admin</a>
  <a href="settings.html">Settings</a>
  <div style="margin-top:auto">
    <div style="color:#d9c08c;font-size:13px">Signed in as</div>
    <div id="sidebarUser" style="font-weight:700;color:#ffd700">—</div>
  </div>
</div>
<!-- Main -->
<div class="main">
  <h1>Leaderboard</h1>

  <div class="tabs">
    <div class="tab active" id="tabTokens">Top Gold</div>
    <div class="tab" id="tabLevel">Top Level</div>
  </div>

  <div id="board" class="board"></div>
</div>


<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";
import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyDe9lhPW1DEli3moVwtywCE0ucXKoZSoXs",
  authDomain: "goldet-504aa.firebaseapp.com",
  databaseURL: "https://goldet-504aa-default-rtdb.firebaseio.com",
  projectId: "goldet-504aa",
  storageBucket: "goldet-504aa.appspot.com",
  messagingSenderId: "36312610816",
  appId: "1:36312610816:web:ded0576d78ebf1ceba00e5",
  measurementId: "G-TTJNTC824V"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);

// Elements
const sidebarUser = document.getElementById("sidebarUser");
const board = document.getElementById("board");
const tabTokens = document.getElementById("tabTokens");
const tabLevel = document.getElementById("tabLevel");

let mode = "tokens"; // default leaderboard type

onAuthStateChanged(auth, async(user)=>{
  if(!user){
    window.location.href = "login.html";
    return;
  }
  sidebarUser.textContent = user.email;
  loadLeaderboard();
});

function loadLeaderboard(){
  const usersRef = ref(db, "users");
  onValue(usersRef, snap => {
    const users = snap.val() || {};
    const arr = [];

    Object.keys(users).forEach(uid=>{
      const u = users[uid];
      arr.push({
        username: u.username || "Unknown",
        chatColor: u.chatColor || "#ffffff",
        tokens: u.tokens || 0,
        level: u.level || 0
      });
    });

    if(mode === "tokens"){
      arr.sort((a,b)=> b.tokens - a.tokens);
      render(arr, "tokens");
    } else {
      arr.sort((a,b)=> b.level - a.level);
      render(arr, "level");
    }
  });
}

function render(list, type){
  board.innerHTML = "";
  let rank = 1;

  list.forEach(u=>{
    const row = document.createElement("div");
    row.className = "row";

    row.innerHTML = `
      <div class="rank">#${rank}</div>
      <div class="username" style="color:${u.chatColor}">${u.username}</div>
      <div class="score">${type==="tokens" ? u.tokens+" Gold" : "Lvl "+u.level}</div>
    `;

    board.appendChild(row);
    rank++;
  });
}

// Tab switching
tabTokens.onclick = ()=>{
  mode = "tokens";
  tabTokens.classList.add("active");
  tabLevel.classList.remove("active");
  loadLeaderboard();
};

tabLevel.onclick = ()=>{
  mode = "level";
  tabLevel.classList.add("active");
  tabTokens.classList.remove("active");
  loadLeaderboard();
};
</script>

</body>
</html>
