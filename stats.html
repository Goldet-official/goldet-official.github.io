<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Goldet | Stats</title>
<link rel="stylesheet" href="stats.css">
<link href="https://fonts.googleapis.com/css2?family=Titan+One&display=swap" rel="stylesheet">
</head>
<body>

<div class="sidebar">
  <h2 class="logo">Goldet</h2>
  
  <ul>
    <li>ğŸ† Stats</li>
    <li>ğŸ“Š Leaderboard</li>
    <li>ğŸ’¬ Chat</li>
    <li>ğŸ›¡ï¸ Clans</li>
    <li>ğŸ›’ Market</li>
    <li>ğŸ“¦ Items</li>
    <li>âš™ï¸ Settings</li>
    <li>ğŸ“° News</li>
  </ul>
</div>

<div class="main">

  <!-- Top Profile Card -->
  <div class="profile-card">
    <div class="avatar"></div>
    <div class="profile-info">
      <h2 class="username" id="usernameDisplay">Loading...</h2>

      <div class="level-bar">
        <div class="bar-fill" id="xpBar"></div>
      </div>

      <p class="level-text" id="levelDisplay">Level 0</p>
    </div>

    <div class="profile-actions">
      <button class="btn">View Stats</button>
      <button class="btn">Trade</button>
    </div>
  </div>

  <!-- Stats Row -->
  <div class="stats-row">
    <div class="stat-box">
      <p class="stat-title">Tokens</p>
      <p class="stat-value" id="tokens">0</p>
    </div>

    <div class="stat-box">
      <p class="stat-title">Golds Unlocked</p>
      <p class="stat-value" id="golds">0 / 0</p>
    </div>

    <div class="stat-box">
      <p class="stat-title">Packs Opened</p>
      <p class="stat-value" id="packs">0</p>
    </div>

    <div class="stat-box">
      <p class="stat-title">Messages Sent</p>
      <p class="stat-value" id="messages">0</p>
    </div>
  </div>

  <!-- Friends -->
  <h2 class="section-title">Friends</h2>
  <div class="friends-grid">
    <div class="friend-card"></div>
    <div class="friend-card"></div>
    <div class="friend-card"></div>
    <div class="friend-card"></div>
    <div class="friend-card"></div>
    <div class="friend-card"></div>
    <div class="friend-card"></div>
    <div class="friend-card"></div>
  </div>

  <!-- Requests -->
  <h2 class="section-title">Requests</h2>
  <div class="requests-grid">
    <div class="request-card"></div>
    <div class="request-card"></div>
    <div class="request-card"></div>
  </div>

</div>


<!-- GOLDEN USER LOADER (NO FIREBASE AUTH, WORKS WITH YOUR SYSTEM) -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyDe9lhPW1DEli3moVwtywCE0ucXKoZSoXs",
  authDomain: "goldet-504aa.firebaseapp.com",
  databaseURL: "https://goldet-504aa-default-rtdb.firebaseio.com",
  projectId: "goldet-504aa",
  storageBucket: "goldet-504aa.firebasestorage.app",
  messagingSenderId: "36312610816",
  appId: "1:36312610816:web:ded0576d78ebf1ceba00e5",
  measurementId: "G-TTJNTC824V"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// Load current user from localStorage
const username = localStorage.getItem("goldetCurrentUser");

// If not logged in, kick out
if (!username) {
  window.location.href = "login.html";
}

// Update username on page
document.querySelector(".username").textContent = username;

// Load user stats
async function loadStats() {
  const snap = await get(ref(db, `users/${username}`));

  if (!snap.exists()) {
    console.log("âš  No user record yet. Creating default stats.");

    // default stats (for new users)
    return set(ref(db, `users/${username}`), {
      level: 1,
      xp: 0,
      goldsUnlocked: 0,
      packsOpened: 0,
      messages: 0,
      friends: 0
    });
  }

  const data = snap.val();

  // Update values on screen
  document.querySelector(".stat-value.tokens").textContent =
    data.tokens ?? 0;

  document.querySelector(".stat-value.golds").textContent =
    (data.goldsUnlocked ?? 0) + " / ???";

  document.querySelector(".stat-value.packs").textContent =
    data.packsOpened ?? 0;

  document.querySelector(".stat-value.messages").textContent =
    data.messages ?? 0;

  document.querySelector(".level-text").textContent =
    "Level " + (data.level ?? 1);

  // XP progress bar
  const progress = Math.min(100, Math.floor((data.xp ?? 0) % 100));
  document.querySelector(".bar-fill").style.width = progress + "%";
}

loadStats();
</script>

</body>
</html>
