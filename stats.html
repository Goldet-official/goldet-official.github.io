<!DOCTYPE html>
<html>
<head>
  <title>Goldet Stats</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>
<header>Goldet â€” Player Stats</header>

<div class="container">

  <!-- NOT LOGGED IN -->
  <div class="card" id="notLogged" style="display:none;">
    <h2>You are not logged in</h2>
    <p>Please log in to view your stats.</p>
    <a href="account.html"><button>Go to Login</button></a>
  </div>

  <!-- LOGGED IN PLAYER STATS -->
  <div class="card" id="statsCard" style="display:none;">
    <h2>Your Stats</h2>

    <p><b>Username:</b> <span id="username">Loading...</span></p>
    <p><b>Coins:</b> <span id="coins">0</span></p>
    <p><b>XP:</b> <span id="xp">0</span></p>
    <p><b>Level:</b> <span id="level">1</span></p>

    <br>

    <button onclick="logout()">Log Out</button>
  </div>

</div>

<script type="module">
  // Your Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyDe9lhPW1DEli3moVwtywCE0ucXKoZSoXs",
    authDomain: "goldet-504aa.firebaseapp.com",
    databaseURL: "https://goldet-504aa-default-rtdb.firebaseio.com",
    projectId: "goldet-504aa",
    storageBucket: "goldet-504aa.firebasestorage.app",
    messagingSenderId: "36312610816",
    appId: "1:36312610816:web:ded0576d78ebf1ceba00e5",
    measurementId: "G-TTJNTC824V"
  };

  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
  import { getAuth, onAuthStateChanged, signOut }
    from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";

  import { getDatabase, ref, onValue }
    from "https://www.gstatic.com/firebasejs/10.7.0/firebase-database.js";

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getDatabase(app);

  // Check if user is logged in
  onAuthStateChanged(auth, (user) => {
    if (!user) {
      notLogged.style.display = "block";
      statsCard.style.display = "none";
      return;
    }

    // Logged in
    notLogged.style.display = "none";
    statsCard.style.display = "block";

    const uid = user.uid;
    const userRef = ref(db, "users/" + uid);

    // Listen for real-time updates to stats
    onValue(userRef, (snapshot) => {
      const data = snapshot.val();

      username.textContent = data.username;
      coins.textContent = data.coins;
      xp.textContent = data.xp;
      level.textContent = data.level;
    });
  });

  // Log out
  window.logout = function() {
    signOut(auth);
  };
</script>

</body>
</html>
