<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Admin Panel</title>
<style>
*{box-sizing:border-box}
html,body{margin:0;padding:0;height:100%;font-family:Arial,system-ui;background:linear-gradient(180deg,#050505,#0b0b0b);color:#fff}
.sidebar{position:fixed;left:0;top:0;bottom:0;width:240px;background: linear-gradient(180deg,#1a1200,#2e1a03);border-right: 2px solid rgba(212,175,55,0.06);padding:22px;display:flex;flex-direction:column;gap:12px}
.logo{font-family:'Titan One',cursive;color:#ffd700;font-size:34px;text-shadow:0 0 8px rgba(212,175,55,0.15)}
.nav a{display:block;color:#ffd;text-decoration:none;padding:10px;border-radius:8px;margin:6px 0;background:transparent}
.nav a:hover{background:rgba(212,175,55,0.06)}
.main{margin-left:260px;padding:30px;min-height:100vh}
h1{font-family:'Titan One',cursive;color:#ffdf80;margin:0 0 12px}
.user-card{background:#0f0f0f;border:2px solid rgba(212,175,55,0.12);padding:18px;border-radius:12px;margin-bottom:20px;box-shadow:0 6px 24px rgba(212,175,55,0.06)}
.section-title{color:#ffd700;font-weight:700;margin-top:10px;margin-bottom:6px}
input,select{width:100%;padding:8px;border-radius:8px;border:1px solid rgba(212,175,55,0.18);background:#111;color:#fff;margin-bottom:6px}
label{font-size:14px;color:#d9c08c}
.save-btn{background:linear-gradient(90deg,#ffd700,#b8860b);color:#000;font-weight:700;padding:10px;border:none;border-radius:8px;margin-top:10px;width:100%;cursor:pointer}
.badge{background:rgba(255,215,0,0.12);padding:4px 6px;border-radius:8px;color:#ffe;font-weight:700;display:inline-block;margin:4px 4px 0 0}
</style>
</head>
<body>

<!-- SIDEBAR -->
<div class="sidebar">
  <div class="logo">ADMIN</div>
  <div class="nav">
    <a href="admin.html">Dashboard</a>
    <a href="stats.html">Stats</a>
    <a href="chat.html">Chat</a>
  </div>
</div>

<!-- MAIN CONTENT -->
<div class="main">
  <h1>Admin Panel</h1>
  <div id="adminName" style="color:#ffd700;font-size:20px;margin-bottom:14px"></div>

  <div id="usersList"></div>
</div>

<!-- FIREBASE -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getDatabase, ref, onValue, update } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";
import { 
  getAuth, 
  onAuthStateChanged 
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

// ðŸ”¥ INSERT YOUR FIREBASE CONFIG HERE
const firebaseConfig = {
  apiKey: "",
  authDomain: "",
  databaseURL: "",
  projectId: "",
  storageBucket: "",
  messagingSenderId: "",
  appId: ""
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const auth = getAuth(app);

let currentAdminUsername = "";

// AUTH + ADMIN VALIDATION
onAuthStateChanged(auth, user => {
  if (!user) return;

  const uid = user.uid;

  // get username from database
  onValue(ref(db, "users/" + uid + "/username"), snap => {
    currentAdminUsername = snap.val();

    // check admin table
    onValue(ref(db, "admin/" + currentAdminUsername), adminSnap => {
      if (adminSnap.val() === true) {
        document.getElementById("adminName").innerText =
          "Logged in as Admin: " + currentAdminUsername;
        loadUsers();
      } else {
        document.getElementById("adminName").innerText =
          "ACCESS DENIED â€“ You are not an admin.";
      }
    });
  });
});


// LOAD ALL USERS
function loadUsers() {
  onValue(ref(db, "users"), snap => {
    const users = snap.val();
    const list = document.getElementById("usersList");
    list.innerHTML = "";

    Object.entries(users).forEach(([uid, u]) => {
      let card = document.createElement("div");
      card.className = "user-card";
      card.innerHTML = `
        <h2 style="color:${u.chatColor?.name || "#ffd700"}">
          ${u.username}
        </h2>

        <label>Username</label>
        <input id="u-${uid}-username" value="${u.username || ""}">

        <label>Name Color</label>
        <input id="u-${uid}-chatColorName" value="${u.chatColor?.name || "#fff"}">

        <label>Text Color</label>
        <input id="u-${uid}-chatColorText" value="${u.chatColor?.text || "#fff"}">

        <label>Messages Sent</label>
        <input id="u-${uid}-messages" value="${u.stats?.messagesSent || 0}">

        <label>Packs Opened</label>
        <input id="u-${uid}-packs" value="${u.stats?.packsOpened || 0}">

        <label>Golds Unlocked</label>
        <input id="u-${uid}-goldsUnlocked" value="${u.stats?.golds || ""}">

        <label>Is Admin</label>
        <select id="u-${uid}-isAdmin">
          <option value="true" ${u.isAdmin ? "selected" : ""}>Yes</option>
          <option value="false" ${!u.isAdmin ? "selected" : ""}>No</option>
        </select>

        <label>Approved</label>
        <select id="u-${uid}-approved">
          <option value="true" ${u.approved ? "selected" : ""}>Yes</option>
          <option value="false" ${!u.approved ? "selected" : ""}>No</option>
        </select>

        <button class="save-btn" onclick="saveUser('${uid}')">Save Changes</button>
      `;
      list.appendChild(card);
    });
  });
}


// SAVE USER
window.saveUser = function(uid) {
  const data = {
    username: document.getElementById(`u-${uid}-username`).value,
    chatColor: {
      name: document.getElementById(`u-${uid}-chatColorName`).value,
      text: document.getElementById(`u-${uid}-chatColorText`).value,
    },
    isAdmin: document.getElementById(`u-${uid}-isAdmin`).value === "true",
    approved: document.getElementById(`u-${uid}-approved`).value === "true",
    stats: {
      messagesSent: Number(document.getElementById(`u-${uid}-messages`).value),
      packsOpened: Number(document.getElementById(`u-${uid}-packs`).value),
      golds: document.getElementById(`u-${uid}-goldsUnlocked`).value
    }
  };

  update(ref(db, "users/" + uid), data);

  // also update admin list
  if (data.isAdmin) {
    update(ref(db, "admin/" + data.username), true);
  } else {
    update(ref(db, "admin/" + data.username), null);
  }

  alert("Saved!");
};
</script>
</body>
</html>
