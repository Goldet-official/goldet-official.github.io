<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Panel</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Titan+One&display=swap">

<style>
    body {
        margin: 0;
        font-family: "Titan One", sans-serif;
        background: #0d0d0d;
        color: #f0d88a;
    }

    .topbar {
        background: #1c1c1c;
        padding: 20px;
        text-align: center;
        font-size: 32px;
        color: #fcd977;
        border-bottom: 4px solid #fcd977;
    }

    .container {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 25px;
        padding: 30px;
    }

    .card {
        background: #1c1c1c;
        border: 3px solid #fcd977;
        border-radius: 12px;
        padding: 20px;
        min-height: 200px;
        box-shadow: 0 0 10px rgba(255, 207, 110, 0.4);
    }

    .card h2 {
        margin-top: 0;
        font-size: 26px;
        color: #ffea9c;
    }

    button {
        background: #ffcf49;
        border: none;
        padding: 10px 15px;
        font-size: 16px;
        cursor: pointer;
        margin-top: 10px;
        border-radius: 8px;
    }

    button:hover {
        background: #ffe083;
    }

    .user-item {
        border-bottom: 1px solid #444;
        padding: 8px 0;
    }

    .small-btn {
        font-size: 14px;
        padding: 5px 8px;
        margin-left: 6px;
    }
</style>
</head>

<body>

<div class="topbar">ADMIN PANEL</div>

<div class="container">

    <!-- Pending Users -->
    <div class="card">
        <h2>Pending Users</h2>
        <div id="pendingList">Loading...</div>
    </div>

    <!-- All Users -->
    <div class="card">
        <h2>Users</h2>
        <div id="userList">Loading...</div>
    </div>

    <!-- Game State -->
    <div class="card">
        <h2>Game State</h2>
        <div id="gameState">Loading...</div>
        <button onclick="toggleGame()">Toggle Game State</button>
    </div>

</div>

<!-- Firebase -->
<script type="module">
    // -----------------------------------------------------
    // ðŸ”¥ YOUR FIREBASE CONFIG â€” INSERT YOURS HERE
    // -----------------------------------------------------
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, onValue, update, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
        apiKey: "",
        authDomain: "",
        databaseURL: "",
        projectId: "",
        storageBucket: "",
        messagingSenderId: "",
        appId: ""
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // ----------------------------
    // Load Pending Users
    // ----------------------------
    const pendingRef = ref(db, "pendingUsers");
    onValue(pendingRef, snapshot => {
        const list = document.getElementById("pendingList");
        list.innerHTML = "";

        if (!snapshot.exists()) {
            list.innerHTML = "No pending users.";
            return;
        }

        snapshot.forEach(child => {
            const u = child.val();
            list.innerHTML += `
                <div class="user-item">
                    <b>${u.username}</b> (${child.key})
                    <button class="small-btn" onclick="approve('${child.key}', '${u.username}', '${u.email}')">Approve</button>
                    <button class="small-btn" onclick="deny('${child.key}')">Deny</button>
                </div>
            `;
        });
    });

    // Approve user
    window.approve = (uid, username, email) => {
        update(ref(db, "users/" + uid), {
            username: username,
            email: email,
            stats: { xp: 0, coins: 0, level: 1 },
            admin: false,
            chatColor: "#ffffff",
            badges: []
        });

        remove(ref(db, "pendingUsers/" + uid));
    };

    // Deny user
    window.deny = (uid) => {
        remove(ref(db, "pendingUsers/" + uid));
    };


    // ----------------------------
    // Load Users
    // ----------------------------
    const usersRef = ref(db, "users");
    onValue(usersRef, snapshot => {
        const list = document.getElementById("userList");
        list.innerHTML = "";

        if (!snapshot.exists()) {
            list.innerHTML = "No users.";
            return;
        }

        snapshot.forEach(child => {
            const u = child.val();
            list.innerHTML += `
                <div class="user-item">
                    <b>${u.username}</b>  
                    <br>XP: ${u.stats?.xp || 0} | Coins: ${u.stats?.coins || 0} | Level: ${u.stats?.level || 1}
                    <br>Admin: ${u.admin ? "YES" : "NO"}
                    <button class="small-btn" onclick="makeAdmin('${child.key}')">Make Admin</button>
                    <button class="small-btn" onclick="delUser('${child.key}')">Delete</button>
                </div>
            `;
        });
    });

    window.makeAdmin = (uid) => {
        update(ref(db, "users/" + uid), { admin: true });
    };

    window.delUser = (uid) => {
        remove(ref(db, "users/" + uid));
    };


    // ----------------------------
    // Game State
    // ----------------------------
    const gameRef = ref(db, "gameState");
    onValue(gameRef, snapshot => {
        document.getElementById("gameState").innerHTML =
            snapshot.exists() ? JSON.stringify(snapshot.val()) : "No game state";
    });

    window.toggleGame = () => {
        update(ref(db, "gameState"), {
            running: Math.random() > 0.5  // Example toggle
        });
    };

</script>

</body>
</html>
